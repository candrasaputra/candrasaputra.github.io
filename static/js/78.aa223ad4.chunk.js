(this["webpackJsonpxendit-dashboard-ui"]=this["webpackJsonpxendit-dashboard-ui"]||[]).push([[78],{1497:function(e,a,t){"use strict";t.r(a);var r=t(9),n=t.n(r),c=t(19),s=t(12),o=t(0),i=t.n(o),l=t(31),u=t.n(l),d=t(27),b=t(380),f=t(67),O=t(511),p=t(284),g=t(205),j=t(80),m=t(1573),E=t(1575),_=t.n(E),D=function(e){return"/api/escrow-transactions/".concat(e)},C=function(e){return"/api/escrow-transactions/".concat(e,"/receipt_data")},k=function(e){return"/api/callback_requests/".concat(e)},v="/api/callback_requests",L="/escrow-account",w=["ESCROW_WITHDRAWAL","LOAN_DISBURSEMENT"],y="PENDING",T="COMPLETED",R="FAILED",M="SETTLED",h="SETTLING",S="LOAN_DISBURSEMENT",A="CALLBACK_URL_NOT_SET",x={1:"callbackErrors:errorCode100",3:"callbackErrors:errorCode300",4:"callbackErrors:errorCode400",5:"callbackErrors:errorCode500"},F=/product_type=([^&]*)/,P=t(288),I=t.n(P),N=t(189),B=function(e,a){return["created","updated","transaction_timestamp","loan_maturity_date"].includes(e)?Object(N.h)(a):["amount","funded_amount","customer_balance"].includes(e)?Object(m.d)(a):a},W=function(e,a){return a.docs.length>1?a.docs.find((function(a){return a.request_payload_id==="".concat(e.id,"_").concat(e.status)})):a.docs[0]},U=Object(b.a)("escrowDetails")((function(e){var a=e.t,t=e.escrowDetails,r=e.amount,n=e.status,c=e.isCredit,s=Object.keys(t).map((function(e){var r=B(e,t[e]);return{label:a(e),value:r||"-"}})),o=Object(m.c)(r,"IDR",c),l=function(e){var a=function(e){return e.replace(/_/g," ")}(I()(null===e||void 0===e?void 0:e.toLowerCase()));switch(e){case T:case M:return i.a.createElement(_.a,{text:a,variant:"success"});case y:case h:return i.a.createElement(_.a,{text:a,variant:"warning"});case R:return i.a.createElement(_.a,{text:a,variant:"danger"});default:return i.a.createElement(_.a,{text:a})}}(n);return i.a.createElement(j.p,{title:a("transactionDetails"),items:s,amountColor:c?"success":"danger",amountValue:o,label:l})})),H=Object(b.a)("escrowDetails")((function(e){var a=e.t,t=e.lenderDetails,r=Object.keys(t).map((function(e){var r=B(e,t[e]);return{label:a(e),value:r||"-"}}));return i.a.createElement(j.p,{title:a("lenderDetails"),items:r})})),K=function(e){var a=e.escrowDetails,t=a.product_type,r=a.lender_details,n=a.status,c=a.amount,s=a.is_credit,o=Object(d.isUndefined)(s)||s,l=t===S,u=Object(d.omit)(a,["product_status","amount","is_credit","payment_type_details","sequence","status","internal_loan","lenders","lender_details"]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(U,{escrowDetails:u,status:n,amount:c,isCredit:o}),l&&r.map((function(e){var a=Object(d.omit)(e,["amount"]);return i.a.createElement(H,{key:e.id,lenderDetails:a})})))},q=t(48),G=Object(b.a)(["escrowDetails","commonWords"])((function(e){var a=e.t,t=e.entity,r=e.callbackDetails,n=e.onDetailsClicked,c=e.isLoading,s=e.callbackFailureReason,o=e.errorMessage,l=e.showResendButton,b=e.onResendCallback,f=e.isResending,O=r.events;return c||o?i.a.createElement(j.z,{isLoading:c,loadingText:a("loadingCallbackEvents"),isError:!Object(d.isEmpty)(o),errorText:o}):i.a.createElement(j.g,{clickableTable:!0,title:a("callbackDetails"),showCallbackButton:l,errorMessage:s,onDetailsClicked:n,buttonText:a("resend"),tableContents:function(e,t){var r=function(e,t){return"FAILED"===t?"Error ".concat(e," - ").concat(a("commonWords:failed")):a("callbackStatusSuccess")};return e.map((function(e,a){var n=e.timestamp,c=e.status,s=e.status_code,o=e.resender_user_name;return{id:a,date:u()(n).format(q.a.FULL_DATE),status:r(s,c),sender:o||Object(d.startCase)(t)}}))}(O,t),onTableDetailsClick:function(e){!function(e,a,t){var r=a[e.id].status_code;t(Object(d.head)(r.toString()))}(e,O,n)},onButtonClick:b,isButtonLoading:f},function(e){return e&&i.a.createElement(p.a,{className:"px-2"},i.a.createElement(g.a,{md:5},i.a.createElement("p",{className:"color-ash-dark"},a("failureReason"))),i.a.createElement(g.a,{md:7},i.a.createElement("p",null,e)))}(s))})),z=t(468),J=t(3),V="FETCH_ESCROW_DETAILS",$="FETCH_ESCROW_DETAILS_ERROR",Q="SET_ESCROW_DETAILS",X="FETCH_CALLBACK_DETAILS",Y="FETCH_CALLBACK_DETAILS_ERROR",Z="SET_CALLBACK_DETAILS",ee="SET_CALLBACK_DETAILS_FAILURE_REASON",ae="RESEND_CALLBACK",te="SET_RESEND_CALLBACK_STATE",re="FETCH_ESCROW_TRANSACTION_PROOF",ne="FETCH_ESCROW_TRANSACTION_PROOF_ERROR",ce="SET_ESCROW_TRANSACTION_PROOF",se="RESET_CONFIRMATION_MODAL",oe=function(e){return Object(d.omit)(e,["response_headers"])},ie={escrowDetails:{amount:0,status:""},escrowTransactionProof:{},callbackDetails:{events:[],id:""},callbackFailureReason:"",isCallbackDisplayed:!1,isLoading:{escrowDetails:!1,callbackDetails:!1,escrowTransactionProof:!1,resendCallback:!1},errorMessage:{escrowDetails:"",callbackDetails:"",escrowTransactionProof:""},confirmationModalConfig:{title:"",subtitle:"",type:"",showModal:!1}},le=function(e,a){var t=a.type,r=a.payload;switch(t){case V:return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowDetails:!0}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{escrowDetails:""})});case $:var n=r.errorMessage;return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowDetails:!1}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{escrowDetails:n})});case Q:var c=r.escrowDetails,s=oe(c);return Object(J.a)(Object(J.a)({},e),{},{escrowDetails:s,isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowDetails:!1}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{escrowDetails:""})});case X:return Object(J.a)(Object(J.a)({},e),{},{callbackFailureReason:"",isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{callbackDetails:!0}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{callbackDetails:""})});case Y:var o=r.errorMessage,i=r.refetch;return Object(J.a)(Object(J.a)({},e),{},{isCallbackDisplayed:i,isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{callbackDetails:!1}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{callbackDetails:o})});case Z:var l=r.callbackDetails,u=Object(d.isEmpty)(l)?e.callbackDetails:l;return Object(J.a)(Object(J.a)({},e),{},{callbackDetails:u,isCallbackDisplayed:!0,isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{callbackDetails:!1}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{callbackDetails:""})});case ee:var b=r.callbackFailureReason;return Object(J.a)(Object(J.a)({},e),{},{callbackFailureReason:b});case ae:return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{resendCallback:!0})});case te:var f=r.confirmationModalConfig;return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{resendCallback:!1}),confirmationModalConfig:Object(J.a)(Object(J.a)(Object(J.a)({},e.confirmationModalConfig),f),{},{showModal:!0})});case re:return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowTransactionProof:!0}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{escrowTransactionProof:""})});case ne:var O=r.errorMessage;return Object(J.a)(Object(J.a)({},e),{},{isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowTransactionProof:!1}),errorMessage:Object(J.a)(Object(J.a)({},e.errorMessage),{},{escrowTransactionProof:O})});case ce:var p=r.escrowTransactionProof,g=oe(p);return Object(J.a)(Object(J.a)({},e),{},{escrowTransactionProof:g,isLoading:Object(J.a)(Object(J.a)({},e.isLoading),{},{escrowTransactionProof:!1})});case se:return Object(J.a)(Object(J.a)({},e),{},{confirmationModalConfig:Object(J.a)(Object(J.a)({},e.confirmationModalConfig),{},{title:"",subtitle:"",type:"",showModal:!1})});default:return e}};a.default=Object(f.o)(Object(b.a)(["escrowDetails","commonWords","errorMessages","callbackErrors"])((function(e){var a=e.t,t=e.user,r=t.can_manage_tech_settings,l=t.can_edit,b=e.apiCall,f=b.axiosGet,m=b.axiosPost,E=e.history,_=e.match,R=e.location,M=e.environment,h=e.entity,S=Object(o.useState)(!1),P=Object(s.a)(S,2),I=P[0],N=P[1],B=Object(o.useReducer)(le,ie),U=Object(s.a)(B,2),H=U[0],q=U[1],J=H.escrowDetails,oe=H.escrowTransactionProof,ue=H.callbackDetails,de=H.callbackFailureReason,be=H.isLoading,fe=H.isCallbackDisplayed,Oe=H.errorMessage,pe=H.confirmationModalConfig;Object(o.useEffect)((function(){N(!0),De()}),[]),Object(o.useEffect)((function(){I&&_e()}),[M]);var ge=R.search?R.search.match(F)[1]:void 0,je=_.params.id,me=J.status!==y&&ue.events.length>0&&fe,Ee=J.status===T&&w.includes(ge),_e=function(){E.push({pathname:L,state:{isFromDetailsPage:!0}})},De=function(){var e=Object(c.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q({type:V}),e.next=3,f(D(je),{product_type:ge});case 3:if(!(t=e.sent).error_code){e.next=7;break}return q({type:$,payload:{errorMessage:Object(z.a)(t.error_code,a)}}),e.abrupt("return");case 7:q({type:Q,payload:{escrowDetails:t}}),Ce(t.status);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e){var a=[];e!==y&&a.push(ke({refetch:!1})),e===T&&a.push(ve()),!Object(d.isEmpty)(a)&&Promise.all(a)},ke=function(){var e=Object(c.a)(n.a.mark((function e(t){var r,c,s,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.refetch,q({type:X}),c={search_query:je,from:u()(J.updated).subtract(7,"days").toISOString(),to:u()(J.updated).add(7,"days").toISOString()},e.next=5,f(v,c);case 5:if(!(s=e.sent).error_code&&s.status!==A){e.next=9;break}return q({type:Y,payload:{errorMessage:Object(z.a)(s.error_code,a),refetch:r}}),e.abrupt("return");case 9:o=W(J,s),q({type:Z,payload:{callbackDetails:o}});case 11:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),ve=function(){var e=Object(c.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.includes(ge)){e.next=2;break}return e.abrupt("return");case 2:return q({type:re}),e.next=5,f(C(je),{product_type:ge});case 5:if(!(t=e.sent).error_code){e.next=9;break}return q({type:ne,payload:{errorMessage:Object(z.a)(t.error_code,a)}}),e.abrupt("return");case 9:q({type:ce,payload:{escrowTransactionProof:t}});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=Object(c.a)(n.a.mark((function e(t){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q({type:ae}),e.next=3,m(k(t));case 3:if(!(r=e.sent).error_code){e.next=7;break}return q({type:te,payload:{confirmationModalConfig:{title:a("commonWords:error"),subtitle:Object(z.a)(r.error_code,a),type:"danger"}}}),e.abrupt("return");case 7:q({type:te,payload:{confirmationModalConfig:{title:a("commonWords:success"),subtitle:a("resendCallbackSuccess"),type:"success"}}}),ke({refetch:!0});case 9:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return i.a.createElement(i.a.Fragment,null,i.a.createElement(j.o,{title:a("headerTitle"),goBack:_e}),be.escrowDetails||Oe.escrowDetails?i.a.createElement(j.z,{isLoading:be.escrowDetails,loadingText:a("loadingEscrowDetails"),isError:!Object(d.isEmpty)(Oe.escrowDetails),errorText:Oe.escrowDetails}):i.a.createElement(O.a,null,i.a.createElement(p.a,null,i.a.createElement(g.a,{lg:6},i.a.createElement(K,{escrowDetails:J}),me&&i.a.createElement(G,{callbackDetails:ue,callbackFailureReason:de,onDetailsClicked:function(e){q({type:ee,payload:{callbackFailureReason:a(x[e])}})},isLoading:be.callbackDetails,errorMessage:Oe.callbackDetails,showResendButton:r||l,onResendCallback:function(){return Le(ue.id)},isResending:be.resendCallback,entity:h})),Ee&&i.a.createElement(g.a,{lg:6},i.a.createElement(j.N,{paymentProof:oe,isLoading:be.escrowTransactionProof,loadingText:a("loadingTransactionProof"),errorText:Oe.escrowTransactionProof,environment:M})))),i.a.createElement(j.j,Object.assign({},pe,{handleClose:function(){q({type:se})},preserveMobileView:!0})))})))},1573:function(e,a,t){"use strict";t.d(a,"a",(function(){return r})),t.d(a,"d",(function(){return n})),t.d(a,"b",(function(){return s})),t.d(a,"c",(function(){return o})),t.d(a,"e",(function(){return i}));var r=function(e,a){return"IDR"!==a&&a?e.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"):e.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")},n=function(e){return e.toLocaleString("en-US").replace(/,/g,".")},c=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.toLocaleString("en-US",{minimumFractionDigits:a?2:0})},s=function(e,a){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=c(e,r),s="IDR"===a?n.replace(/,/g,"."):n,o=t?"".concat(a," "):"",i="".concat(o).concat(s);return i},o=function(e,a,t){var r=a?s(e,a):c(e),n=r.split("-").join(""),o="".concat((null!=t?t:e>0)?"+ ":"- "," ").concat(n);return 0===e&&(o=r),o},i=function(e){return"".concat((100*e).toFixed(2),"%")}},1575:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var r=o(t(0)),n=o(t(2)),c=o(t(6)),s=o(t(1576));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}t(1577);var l=function(e){var a,t=e.text,n=e.iconLeft,o=e.customCss,l=e.variant,u=(0,c.default)((i(a={"status-pill":!0},"status-pill-".concat(l),l),i(a,o,o),a));return r.default.createElement(s.default,{text:t,iconLeft:n,customCss:u})};l.propTypes={text:n.default.string,iconLeft:n.default.any,variant:n.default.oneOf(["success","danger","warning","first-level","second-level"]),customCss:n.default.string};var u=l;a.default=u},1576:function(e,a,t){Object.defineProperty(a,"__esModule",{value:!0}),e.exports=t(467)},1577:function(e,a,t){}}]);